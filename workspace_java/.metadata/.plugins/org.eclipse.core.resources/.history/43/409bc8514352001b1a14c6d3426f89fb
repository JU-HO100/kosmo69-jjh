package kakao.api;

public class LoginController {
	  String kakaoUrl = kakaoLogin.getAuthorizationUrl(session);

	  /* 생성한 인증 URL을 View로 전달 */
	  model.addAttribute("kakao_url", kakaoUrl);
	  
	  /**
	   * 카카오 로그인 콜백
	   *
	   * @return String
	   * @throws Exception
	   */
	 @RequestMapping(value = "/kakaoOauth.do")
	 public String getKakaoSignIn(ModelMap model,@RequestParam("code") String code, HttpSession session) throws Exception {

	   JsonNode userInfo = kakaoLogin.getKakaoUserInfo(code);

	   System.out.println(userInfo);

	   String id = userInfo.get("id").toString();
	   String email = userInfo.get("kaccount_email").toString();
	   String image = userInfo.get("properties").get("profile_image").toString();
	   String nickname = userInfo.get("properties").get("nickname").toString();

	   System.out.println(id + email);


	   model.addAttribute("k_userInfo", userInfo);
	   model.addAttribute("id", id);
	   model.addAttribute("email", email);
	   model.addAttribute("nickname", nickname);
	   model.addAttribute("image", image);

	   return "main/main.tiles";
	 }
}	
