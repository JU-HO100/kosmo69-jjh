package com.board;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.log4j.Logger;
import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.mvc.multiaction.MultiActionController;

import com.util.HashMapBinder;

public class BoardController extends MultiActionController{
	Logger logger = Logger.getLogger(BoardController.class);
	String bs_file = null;
	//@Autowired
	private BoardLogic boardLogic = null;
	public void setBoardLogic(BoardLogic boardLogic) {
		this.boardLogic = boardLogic;
	}
	//전체 조회 나 조건 검색 구현
	public ModelAndView boardList(HttpServletRequest req, HttpServletResponse res){
		logger.info("boardList 호출 성공");
		List<Map<String,Object>> boardList = null;
		Map<String,Object> pmap = new HashMap<>();
		HashMapBinder hmb = new HashMapBinder(req);
		hmb.bind(pmap);		
		boardList = boardLogic.boardList(pmap);
		ModelAndView mav = new ModelAndView();
		mav.addObject("boardList", boardList);
		mav.setViewName("board/boardList");
		return mav;
	}
	//상세보기 페이지 구현 - 1건을 가져옴 WEB-INF/view/board/ - read.jsp
	public ModelAndView boardDetail(HttpServletRequest req, HttpServletResponse res){
		logger.info("boardDetail 호출 성공");
		List<Map<String,Object>> boardList = null;
		Map<String,Object> pmap = new HashMap<>();
		HashMapBinder hmb = new HashMapBinder(req);
		hmb.bind(pmap);
		boardList = boardLogic.boardList(pmap);
		ModelAndView mav = new ModelAndView();
		mav.addObject("boardDetail", boardList);
		mav.setViewName("board/read");
		return mav;
	}
	//글수정 입력 화면 구현 - 1건을 가져옴 webapp/board/ - repleForm.jsp
	public String repleForm(HttpServletRequest req, HttpServletResponse res){
		logger.info("boardDetail 호출 성공");
		List<Map<String,Object>> boardList = null;
		Map<String,Object> pmap = new HashMap<>();
		HashMapBinder hmb = new HashMapBinder(req);
		hmb.bind(pmap);
		boardList = boardLogic.boardList(pmap);
		logger.info("Con repleForm:"+boardList);
		req.setAttribute("repleForm",boardList);
		return "forward:/board/repleForm.jsp";//앞에 forward가 있어야 redirect인지 forward인지 식별을 한다.
	}
	public void boardInsert(HttpServletRequest req, HttpServletResponse res)
	throws Exception
	{
		logger.info("boardInsert 호출 성공");
		int result = 0;
		Map<String,Object> pmap = new HashMap<>();
		HashMapBinder hmb = new HashMapBinder(req);
		hmb.bind(pmap);
		String savePath = "C:\\workspace_sts3\\spring3_1\\src\\main\\webapp\\pds";
		String fullPath = null;
		String filename = null;
		if(bs_file !=null) {
			filename = bs_file.getOriginalFilename();
			fullPath = savePath+"\\"+filename;
		}
		logger.info("fullPath:"+fullPath);
		//첨부 파일이 존재하니?
		if("첨부파일".equals("첨부파일")) {
			logger.info("첨부파일이 존해하는경우");
		}
//		result = boardLogic.boardInsert(pmap);
		if(result == 1) {//등록 성공한거니?
			res.sendRedirect("/board/boardList.sp");
		}else {
			res.sendRedirect("/board/boardInsertFail.sp");			
		}
	}
	public void writeForm(HttpServletRequest req, HttpServletResponse res)
			throws Exception
	{
		logger.info("Con writeForm 호출 성공");
		res.sendRedirect("writeForm.jsp");
	}
	public ModelAndView writeForm2(HttpServletRequest req, HttpServletResponse res)
			throws Exception
	{
		logger.info("Con writeForm2 호출 성공");
		ModelAndView mav = new ModelAndView();
		mav.setViewName("board/writeForm");
		return mav;
	}
}
