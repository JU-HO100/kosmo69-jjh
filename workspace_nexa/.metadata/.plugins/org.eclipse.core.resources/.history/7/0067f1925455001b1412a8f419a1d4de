package com.mvc.dept;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.log4j.Logger;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.google.gson.Gson;
import com.nexacro17.xapi.data.DataSet;
import com.nexacro17.xapi.data.PlatformData;
import com.nexacro17.xapi.tx.HttpPlatformRequest;
import com.nexacro17.xapi.tx.PlatformException;

@RestController
@RequestMapping("/dept/*")
public class RestDeptController {
	Logger logger = Logger.getLogger(RestDeptController.class);
	@RequestMapping("total.kosmo")
	public String total() {
		
		return "10";
	}
	@RequestMapping(value="getName.kosmo",produces="application/json;charset=UTF-8")
	public String getName() {
		
		return "한글";
	}
	@RequestMapping(value="getName.kosmo",produces="application/json;charset=UTF-8")
	public String getDept() {
		List<Map<String,Object>> deptList = new ArrayList<>();
		//DB에서 가져와서 출력하기
		//DeptDao.java, Configure.xml, dept.xml
		//MVC패턴 얹어서 개발을 진행해야 함
		//파이썬은 모두 필요없다.
		//
		Map<String,Object> rMap = new HashMap<>();
		rMap.put("deptno",10);
		rMap.put("dame","영업");
		rMap.put("loc","부산");
		deptList.add(rMap);
		rMap = new HashMap<>();
		rMap.put("deptno",20);
		rMap.put("dame","총무");
		rMap.put("loc","서울");
		deptList.add(rMap);
		rMap = new HashMap<>();
		rMap.put("deptno",30);
		rMap.put("dame","인사");
		rMap.put("loc","경기");
		deptList.add(rMap);
		
		Gson g = new Gson();
		String imsi = g.toJson(deptList);
		return imsi;
	}
	@GetMapping(value="deptXML.kosmo",produces="application/json;charset=UTF-8")
	public void deptXML() throws PlatformException
	{
		logger.info("deptXML 호출");
		HttpPlatformRequest nreq = new HttpPlatformRequest(req);
		nreq.receiveData();
		//넥사크로에서 제공하는 데이터셋에 담긴 정보를 자바코드에서 읽어오기 위한 코드
		PlatformData in_ndata = nreq.getData();
		//넥사크로에서 제공하는 데이터셋을 자바코드로 제공하는 클래스이다.
		DataSet ds_dept = in_ndata.getDataSet("indept");
	}
}
